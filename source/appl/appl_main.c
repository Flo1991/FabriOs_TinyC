/*********************************************************************************************************************/
/**
 *  ______    _          _    ____
 * |  ____|  | |        (_)  / __ \
 * | |__ __ _| |__  _ __ _  | |  | |___
 * |  __/ _` | '_ \| '__| | | |  | / __|
 * | | | (_| | |_) | |  | | | |__| \__ \
 * |_|  \__,_|_.__/|_|  |_|  \____/|___/
 *
 * Tiny C implementation for Attiny2313
 *
 * Copyright (c) 2025, Flo1991
 * BSD 3-Clause License - see LICENSE file for details
 *
 * @file : appl_main.c
 * @author : Florian Wank
 * @date : 23.04.2025
 *
 *
 * @brief  main source file
 *
 * @details
 * This is the main source file of the project. Its name is no simply main,
 * because if used with some testing tools the file "main.c" will be reserved
 * for the testrunner main.
 *
 */
/*********************************************************************************************************************/

/*********************************************************************************************************************
 * Module Includes
 **********************************************************************************************************************/
#include "appl/appl_main.h"
#include "common/common.h"
#include "common/types.h"
#include "mcal/core/core.h"
#include "mcal/gpt/gpt.h"
#include "servl/schm/schm.h"

/**********************************************************************************************************************
 * Module Definitions
 **********************************************************************************************************************/

/**********************************************************************************************************************
 * Module Constants
 **********************************************************************************************************************/

/**********************************************************************************************************************
 * Module Enumerations
 **********************************************************************************************************************/

/**********************************************************************************************************************
 * Global Variables
 **********************************************************************************************************************/

/**********************************************************************************************************************
 * Module Variables
 **********************************************************************************************************************/

/**********************************************************************************************************************
 * Module Prototypes
 **********************************************************************************************************************/

/**********************************************************************************************************************
 * Module Function Definitions
 **********************************************************************************************************************/

__attribute__((noreturn)) void appl_main(void)
{
  schm_init();

  /* connected LED on pin PD0 */
  /* set gpio to output */
  *REG_DDRD |= (1 << 0); 
  /* set output to high */
  *REG_PORTD |= (1 << 0);
  gpt_init();

  /* call the scheduler application; use rjmp to save stack data, because
    function call results in rcall which stores the pc + 1 on as 16 bit on stack
  */
  asm volatile("rjmp Sched_run" ::);
  while (1)
  {
  }
}
